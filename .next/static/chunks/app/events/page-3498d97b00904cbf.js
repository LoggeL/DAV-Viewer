(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[38],{5270:function(e,t,a){Promise.resolve().then(a.bind(a,8499))},8499:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var r=a(7437),n=a(2265);function l(){let[e,t]=(0,n.useState)({serverUrl:"",username:"",password:""}),[a,l]=(0,n.useState)([]),[c,o]=(0,n.useState)(new Set),[u,h]=(0,n.useState)(()=>i(new Date(new Date().getFullYear(),new Date().getMonth(),1))),[v,p]=(0,n.useState)(()=>i(new Date(new Date().getFullYear(),new Date().getMonth()+1,0))),[g,m]=(0,n.useState)([]),[x,j]=(0,n.useState)(!1),[S,f]=(0,n.useState)(null);async function w(e,t){let a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();if(!a.ok)throw Error((null==r?void 0:r.error)||"Fehler");return r}async function y(){let t=u?new Date(u):null,r=v?new Date(v):null,n=[...c],l="demo"===e.serverUrl?{demo:!0}:{serverUrl:e.serverUrl,username:e.username,password:e.password},s=await Promise.all(n.map(async e=>{let{events:a}=await w("/api/list-events",{...l,calendarUrl:e,timeMin:t?t.toISOString():void 0,timeMax:r?new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999).toISOString():void 0});return{url:e,events:a||[]}})),i=[];for(let e of a){var d;for(let t of(null===(d=s.find(t=>t.url===e.url))||void 0===d?void 0:d.events)||[])i.push({cal:e,e:t})}i.sort((e,t)=>new Date(e.e.start)-new Date(t.e.start)),m(i)}function b(e){f(e||null),j(!0)}async function C(t){let a="demo"===e.serverUrl?{demo:!0}:{serverUrl:e.serverUrl,username:e.username,password:e.password};try{t.href?await w("/api/update-event",{...a,calendarObjectUrl:t.href,etag:t.etag,event:t.event}):await w("/api/create-event",{...a,calendarUrl:t.calendarUrl,event:t.event}),await y(),j(!1),f(null)}catch(e){alert(e.message||"Fehler beim Speichern")}}async function D(t){if(!confirm("Termin wirklich l\xf6schen?"))return;let a="demo"===e.serverUrl?{demo:!0}:{serverUrl:e.serverUrl,username:e.username,password:e.password};try{await w("/api/delete-event",{...a,calendarObjectUrl:t.href,etag:t.etag}),await y()}catch(e){alert(e.message||"Fehler beim L\xf6schen")}}return(0,n.useEffect)(()=>{try{let e=localStorage.getItem("caldavWebappCredsV2");if(e){let a=JSON.parse(e);t({serverUrl:a.serverUrl||"",username:a.username||"",password:a.password||""}),l(Array.isArray(a.calendars)?a.calendars:[]),o(new Set(Array.isArray(a.selectedCalendarUrls)?a.selectedCalendarUrls:[]))}}catch(e){}},[]),(0,n.useEffect)(()=>{try{let e=localStorage.getItem("caldavWebappCredsV2"),t=e?JSON.parse(e):{};t.calendars=a,t.selectedCalendarUrls=[...c],localStorage.setItem("caldavWebappCredsV2",JSON.stringify(t))}catch(e){}},[a,c]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("section",{className:"card",children:[(0,r.jsx)("h2",{children:"Kalender"}),(0,r.jsx)("div",{className:"calendar-list",children:a.map(e=>(0,r.jsxs)("div",{className:"calendar-item",children:[(0,r.jsx)("input",{type:"checkbox",checked:c.has(e.url),onChange:t=>(function(e,t){let a=new Set(c);t?a.add(e):a.delete(e),o(a)})(e.url,t.target.checked)}),(0,r.jsx)("span",{children:e.displayName}),(0,r.jsx)("span",{className:"pill",style:{borderColor:e.color||"var(--border)",color:e.color||"var(--muted)"},children:e.color||"#"}),(0,r.jsx)("button",{onClick:()=>b({calendarUrl:e.url}),children:"Neu"})]},e.url))}),(0,r.jsxs)("div",{className:"row",children:[(0,r.jsxs)("label",{children:["Von",(0,r.jsx)("input",{type:"date",value:u,onChange:e=>h(e.target.value)})]}),(0,r.jsxs)("label",{children:["Bis",(0,r.jsx)("input",{type:"date",value:v,onChange:e=>p(e.target.value)})]}),(0,r.jsx)("button",{onClick:y,children:"Termine laden"})]})]}),(0,r.jsxs)("section",{className:"card",children:[(0,r.jsx)("h2",{children:"Termine"}),(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Kalender"}),(0,r.jsx)("th",{children:"Betreff"}),(0,r.jsx)("th",{children:"Start"}),(0,r.jsx)("th",{children:"Ende"}),(0,r.jsx)("th",{})]})}),(0,r.jsx)("tbody",{children:g.map(e=>{let{cal:t,e:a}=e;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:t.displayName}),(0,r.jsx)("td",{children:a.summary||""}),(0,r.jsx)("td",{children:d(a.start,a.allDay)}),(0,r.jsx)("td",{children:d(a.end,a.allDay)}),(0,r.jsxs)("td",{children:[(0,r.jsx)("button",{onClick:()=>b({href:a.href,etag:a.etag,calendarUrl:t.url,summary:a.summary,description:a.description,location:a.location,start:a.start,end:a.end,allDay:a.allDay}),children:"Bearbeiten"}),(0,r.jsx)("button",{className:"danger",onClick:()=>D(a),children:"L\xf6schen"})]})]},a.href)})})]})]}),x&&(0,r.jsx)(s,{onCancel:()=>j(!1),onSave:C,calendars:a,initial:S})]})}function s(e){var t;let{onCancel:a,onSave:l,calendars:s,initial:i}=e,[d,o]=(0,n.useState)((null==i?void 0:i.href)||""),[u,h]=(0,n.useState)((null==i?void 0:i.etag)||""),[v,p]=(0,n.useState)((null==i?void 0:i.calendarUrl)||(null===(t=s[0])||void 0===t?void 0:t.url)||""),[g,m]=(0,n.useState)((null==i?void 0:i.summary)||""),[x,j]=(0,n.useState)((null==i?void 0:i.description)||""),[S,f]=(0,n.useState)((null==i?void 0:i.location)||""),[w,y]=(0,n.useState)(!!(null==i?void 0:i.allDay)),b=(null==i?void 0:i.start)?new Date(i.start):new Date,C=new Date((null==i?void 0:i.end)?i.end:b.getTime()+36e5),[D,N]=(0,n.useState)(c(b)),[U,k]=(0,n.useState)(c(C));return(0,r.jsxs)("section",{className:"card",id:"editSection",children:[(0,r.jsx)("h2",{id:"editTitle",children:d?"Termin bearbeiten":"Neuer Termin"}),(0,r.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),!D||!U)return alert("Bitte Start/Ende angeben");let t=new Date(D),a=new Date(U);if(a<=t)return alert("Ende muss nach Start liegen");l({calendarUrl:v,href:d||void 0,etag:u||void 0,event:{summary:g.trim(),description:x.trim(),location:S.trim(),start:t.toISOString(),end:a.toISOString(),allDay:w}})},children:[(0,r.jsx)("input",{type:"hidden",value:d,onChange:e=>o(e.target.value)}),(0,r.jsx)("input",{type:"hidden",value:u,onChange:e=>h(e.target.value)}),(0,r.jsxs)("label",{children:["Kalender",(0,r.jsx)("select",{required:!0,value:v,onChange:e=>p(e.target.value),children:s.map(e=>(0,r.jsx)("option",{value:e.url,children:e.displayName},e.url))})]}),(0,r.jsxs)("label",{children:["Betreff",(0,r.jsx)("input",{type:"text",required:!0,value:g,onChange:e=>m(e.target.value)})]}),(0,r.jsxs)("label",{children:["Beschreibung",(0,r.jsx)("textarea",{rows:3,value:x,onChange:e=>j(e.target.value)})]}),(0,r.jsxs)("label",{children:["Ort",(0,r.jsx)("input",{type:"text",value:S,onChange:e=>f(e.target.value)})]}),(0,r.jsxs)("div",{className:"row",children:[(0,r.jsxs)("label",{children:["Start",(0,r.jsx)("input",{type:"datetime-local",required:!0,value:D,onChange:e=>N(e.target.value)})]}),(0,r.jsxs)("label",{children:["Ende",(0,r.jsx)("input",{type:"datetime-local",required:!0,value:U,onChange:e=>k(e.target.value)})]})]}),(0,r.jsxs)("label",{className:"checkbox",children:[(0,r.jsx)("input",{type:"checkbox",checked:w,onChange:e=>y(e.target.checked)})," Ganzt\xe4gig"]}),(0,r.jsxs)("div",{className:"row right",children:[(0,r.jsx)("button",{type:"button",onClick:a,children:"Abbrechen"}),(0,r.jsx)("button",{type:"submit",children:"Speichern"})]})]})]})}function i(e){let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(r)}function c(e){let t=i(e),a=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0");return"".concat(t,"T").concat(a,":").concat(r)}function d(e,t){if(!e)return"";let a=new Date(e);return t?i(a):"".concat(i(a)," ").concat(String(a.getHours()).padStart(2,"0"),":").concat(String(a.getMinutes()).padStart(2,"0"))}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=5270)}),_N_E=e.O()}]);