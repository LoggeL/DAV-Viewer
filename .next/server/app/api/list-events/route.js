(()=>{var e={};e.id=356,e.ids=[356],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},4026:e=>{"use strict";e.exports=require("string_decoder")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},8150:()=>{},5405:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>w,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var n={};r.r(n),r.d(n,{POST:()=>l});var a=r(9303),s=r(8716),o=r(3131),i=r(7070),u=r(8097);async function l(e){try{let t=await e.json();if((0,u.xf)(t)){(0,u.LO)();let{calendarUrl:e,timeMin:r,timeMax:n}=t;if(!e)return i.NextResponse.json({error:"calendarUrl ist erforderlich"},{status:400});let a=new Date(r||Date.now()-2592e6),s=new Date(n||Date.now()+5184e6),o=(u.Ig.events.get(e)||[]).filter(e=>{let t=new Date(e.start);return t>=a&&t<=s});return i.NextResponse.json({events:o})}(0,u.R4)(t);let{serverUrl:r,username:n,password:a,calendarUrl:s,timeMin:o,timeMax:l}=t;if(!s)return i.NextResponse.json({error:"calendarUrl ist erforderlich"},{status:400});let p=await (0,u.kH)({serverUrl:r,username:n,password:a}),d=(await p.fetchCalendars()).find(e=>e.url===s);if(!d)return i.NextResponse.json({error:"Kalender nicht gefunden"},{status:404});let c=new Date(o||Date.now()-2592e6),m=new Date(l||Date.now()+5184e6),f=(await p.calendarQuery({url:d.url,timeRange:{start:c,end:m},expand:!1,depth:1})||[]).map(e=>{let t=(0,u.ke)(e.data);return t?{href:e.href,etag:e.etag||null,...t}:null}).filter(Boolean);return i.NextResponse.json({events:f})}catch(e){return i.NextResponse.json({error:e.message||"Fehler"},{status:e.status||500})}}let p=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/list-events/route",pathname:"/api/list-events",filename:"route",bundlePath:"app/api/list-events/route"},resolvedPagePath:"/workspace/app/api/list-events/route.js",nextConfigOutput:"",userland:n}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:m}=p,f="/api/list-events/route";function w(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},8097:(e,t,r)=>{"use strict";r.d(t,{Ig:()=>i,Jp:()=>c,LO:()=>u,R4:()=>l,kH:()=>p,ke:()=>d,vk:()=>m,xf:()=>o});var n=r(9394),a=r(1625);let s="1"===process.env.DEMO||"1"===process.env.DEMO_MODE;function o(e){return!!s||!!e&&(!0===e.demo||"string"==typeof e.serverUrl&&"demo"===e.serverUrl.trim().toLowerCase())}let i={calendars:[{url:"demo://work",displayName:"Work",ctag:"1",color:"#3b82f6"},{url:"demo://personal",displayName:"Personal",ctag:"1",color:"#22c55e"}],events:new Map};function u(){if(i.events.size>0)return;let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),9,0,0,0),r=(e,r,n=1,a="Meeting",s=!1)=>{let o=new Date(t.getTime()+864e5*r),i=new Date(o.getTime()+36e5*n),u=m(10);return{href:`${e}/evt-${u}.ics`,etag:`"${m(6)}"`,uid:u,summary:a,description:"",location:"",start:o.toISOString(),end:i.toISOString(),allDay:s}};i.events.set("demo://work",[r("demo://work",-2,1,"Sync mit Team"),r("demo://work",-1,2,"Projekt Kickoff"),r("demo://work",0,1,"1:1 Check-in"),r("demo://work",1,1,"Architektur-Review"),r("demo://work",3,2,"Sprint Planung")]),i.events.set("demo://personal",[r("demo://personal",0,0,"Geburtstag",!0),r("demo://personal",2,1,"Arzttermin"),r("demo://personal",4,1,"Laufen im Park"),r("demo://personal",6,2,"Familienessen"),r("demo://personal",-3,1,"Einkaufen")])}function l(e){if(o(e))return;let{serverUrl:t,username:r,password:n}=e||{};if(!t||!r||!n){let e=Error("serverUrl, username und password sind erforderlich");throw e.status=400,e}}async function p({serverUrl:e,username:t,password:r}){let n=await (0,a.G6)({serverUrl:e,credentials:{username:t,password:r},authMethod:"Basic",defaultAccountType:"caldav"});return await n.login(),n}function d(e){try{let t=n.Z.parse(e),r=new n.Z.Component(t).getFirstSubcomponent("vevent");if(!r)return null;let a=new n.Z.Event(r);return{uid:a.uid,summary:a.summary||"",description:a.description||"",location:a.location||"",start:a.startDate?a.startDate.toJSDate():null,end:a.endDate?a.endDate.toJSDate():null,allDay:!!a.startDate&&a.startDate.isDate}}catch(e){return null}}function c({uid:e,summary:t,description:r,location:a,start:s,end:o,allDay:i}){let u=new n.Z.Component(["vcalendar",[],[]]);u.updatePropertyWithValue("prodid","-//CalDAV Webapp//EN"),u.updatePropertyWithValue("version","2.0");let l=new n.Z.Component("vevent"),p=new n.Z.Event(l);e&&(p.uid=e);let d=new Date(s),c=new Date(o);if(i){let e=n.Z.Time.fromJSDate(d,!1);e.isDate=!0;let t=n.Z.Time.fromJSDate(c,!1);t.isDate=!0,p.startDate=e,p.endDate=t}else{let e=n.Z.Time.fromJSDate(d,!0),t=n.Z.Time.fromJSDate(c,!0);p.startDate=e,p.endDate=t}return p.summary=t||"",p.description=r||"",p.location=a||"",u.addSubcomponent(l),u.toString()}function m(e=16){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",r="";for(let n=0;n<e;n++)r+=t[Math.floor(Math.random()*t.length)];return r}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,801],()=>r(5405));module.exports=n})();