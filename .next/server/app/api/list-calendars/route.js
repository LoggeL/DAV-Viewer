(()=>{var e={};e.id=363,e.ids=[363],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},4026:e=>{"use strict";e.exports=require("string_decoder")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},1568:e=>{"use strict";e.exports=require("zlib")},8150:()=>{},1434:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>p,routeModule:()=>c,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var a={};r.r(a),r.d(a,{POST:()=>u});var n=r(9303),s=r(8716),o=r(3131),i=r(7070),l=r(8097);async function u(e){try{let t=await e.json();if((0,l.xf)(t)){(0,l.LO)();let e=l.Ig.calendars.map(e=>({url:e.url,displayName:e.displayName,ctag:e.ctag||null,color:e.color||null}));return i.NextResponse.json({calendars:e})}(0,l.R4)(t);let{serverUrl:r,username:a,password:n}=t,s=await (0,l.kH)({serverUrl:r,username:a,password:n}),o=(await s.fetchCalendars()).filter(e=>(e.components||[]).includes("VEVENT")).map(e=>({url:e.url,displayName:e.displayName||e.url,ctag:e.ctag||null,color:e.color||null}));return i.NextResponse.json({calendars:o})}catch(e){return i.NextResponse.json({error:e.message||"Fehler"},{status:e.status||500})}}let c=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/list-calendars/route",pathname:"/api/list-calendars",filename:"route",bundlePath:"app/api/list-calendars/route"},resolvedPagePath:"/workspace/app/api/list-calendars/route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:d,serverHooks:m}=c,f="/api/list-calendars/route";function g(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},8097:(e,t,r)=>{"use strict";r.d(t,{Ig:()=>i,Jp:()=>d,LO:()=>l,R4:()=>u,kH:()=>c,ke:()=>p,vk:()=>m,xf:()=>o});var a=r(9394),n=r(1625);let s="1"===process.env.DEMO||"1"===process.env.DEMO_MODE;function o(e){return!!s||!!e&&(!0===e.demo||"string"==typeof e.serverUrl&&"demo"===e.serverUrl.trim().toLowerCase())}let i={calendars:[{url:"demo://work",displayName:"Work",ctag:"1",color:"#3b82f6"},{url:"demo://personal",displayName:"Personal",ctag:"1",color:"#22c55e"}],events:new Map};function l(){if(i.events.size>0)return;let e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),9,0,0,0),r=(e,r,a=1,n="Meeting",s=!1)=>{let o=new Date(t.getTime()+864e5*r),i=new Date(o.getTime()+36e5*a),l=m(10);return{href:`${e}/evt-${l}.ics`,etag:`"${m(6)}"`,uid:l,summary:n,description:"",location:"",start:o.toISOString(),end:i.toISOString(),allDay:s}};i.events.set("demo://work",[r("demo://work",-2,1,"Sync mit Team"),r("demo://work",-1,2,"Projekt Kickoff"),r("demo://work",0,1,"1:1 Check-in"),r("demo://work",1,1,"Architektur-Review"),r("demo://work",3,2,"Sprint Planung")]),i.events.set("demo://personal",[r("demo://personal",0,0,"Geburtstag",!0),r("demo://personal",2,1,"Arzttermin"),r("demo://personal",4,1,"Laufen im Park"),r("demo://personal",6,2,"Familienessen"),r("demo://personal",-3,1,"Einkaufen")])}function u(e){if(o(e))return;let{serverUrl:t,username:r,password:a}=e||{};if(!t||!r||!a){let e=Error("serverUrl, username und password sind erforderlich");throw e.status=400,e}}async function c({serverUrl:e,username:t,password:r}){let a=await (0,n.G6)({serverUrl:e,credentials:{username:t,password:r},authMethod:"Basic",defaultAccountType:"caldav"});return await a.login(),a}function p(e){try{let t=a.Z.parse(e),r=new a.Z.Component(t).getFirstSubcomponent("vevent");if(!r)return null;let n=new a.Z.Event(r);return{uid:n.uid,summary:n.summary||"",description:n.description||"",location:n.location||"",start:n.startDate?n.startDate.toJSDate():null,end:n.endDate?n.endDate.toJSDate():null,allDay:!!n.startDate&&n.startDate.isDate}}catch(e){return null}}function d({uid:e,summary:t,description:r,location:n,start:s,end:o,allDay:i}){let l=new a.Z.Component(["vcalendar",[],[]]);l.updatePropertyWithValue("prodid","-//CalDAV Webapp//EN"),l.updatePropertyWithValue("version","2.0");let u=new a.Z.Component("vevent"),c=new a.Z.Event(u);e&&(c.uid=e);let p=new Date(s),d=new Date(o);if(i){let e=a.Z.Time.fromJSDate(p,!1);e.isDate=!0;let t=a.Z.Time.fromJSDate(d,!1);t.isDate=!0,c.startDate=e,c.endDate=t}else{let e=a.Z.Time.fromJSDate(p,!0),t=a.Z.Time.fromJSDate(d,!0);c.startDate=e,c.endDate=t}return c.summary=t||"",c.description=r||"",c.location=n||"",l.addSubcomponent(u),l.toString()}function m(e=16){let t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",r="";for(let a=0;a<e;a++)r+=t[Math.floor(Math.random()*t.length)];return r}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,801],()=>r(1434));module.exports=a})();