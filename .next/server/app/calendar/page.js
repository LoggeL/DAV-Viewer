(()=>{var e={};e.id=329,e.ids=[329],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},394:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>s.a,__next_app__:()=>h,originalPathname:()=>d,pages:()=>c,routeModule:()=>g,tree:()=>u}),r(5671),r(7764),r(5866);var a=r(3191),n=r(8716),l=r(7922),s=r.n(l),i=r(5231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);r.d(t,o);let u=["",{children:["calendar",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,5671)),"/workspace/app/calendar/page.js"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,7764)),"/workspace/app/layout.js"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/workspace/app/calendar/page.js"],d="/calendar/page",h={require:r,loadChunk:()=>Promise.resolve()},g=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/calendar/page",pathname:"/calendar",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},2205:(e,t,r)=>{Promise.resolve().then(r.bind(r,1053))},9447:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,9404,23))},1251:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},1053:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var a=r(326),n=r(7577),l=r(5047);function s(){(0,l.useRouter)(),(0,l.useSearchParams)();let[e,t]=(0,n.useState)({serverUrl:"",username:"",password:""}),[r,s]=(0,n.useState)([]),[i,y]=(0,n.useState)(new Set),[k,M]=(0,n.useState)("month"),[C,P]=(0,n.useState)(new Date),[$,N]=(0,n.useState)(new Map),[F,A]=(0,n.useState)(!1),[O,T]=(0,n.useState)(null),U=(0,n.useRef)(null),_=(0,n.useCallback)(async(e,t)=>{let r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await r.json();if(!r.ok)throw Error(a?.error||"Fehler");return a},[]),E=(0,n.useCallback)(()=>{let e=new Date(C);if("month"===k){let t=g(new Date(e.getFullYear(),e.getMonth(),1)),r=new Date(t.getTime()+35424e5);return r.setHours(23,59,59,999),{start:t,end:r}}if("week"===k){let t=g(e),r=new Date(t.getTime()+5184e5);return r.setHours(23,59,59,999),{start:t,end:r}}if("agenda"===k){let t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),r=new Date(t.getTime()+25056e5);return r.setHours(23,59,59,999),{start:t,end:r}}let t=new Date(e.getFullYear(),e.getMonth(),e.getDate()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,999);return{start:t,end:r}},[C,k]),q=(0,n.useMemo)(()=>{let{start:e,end:t}=E();return"month"===k?f(C):"week"===k||"agenda"===k?`${v(e)} – ${v(t)} ${e.getFullYear()}`:S(e)},[C,k,E]),H=(0,n.useCallback)(()=>{let e=[];for(let t of r)if(i.has(t.url))for(let r of $.get(t.url)||[])e.push({cal:t,e:r});return e},[r,i,$]),Y=(0,n.useCallback)(e=>{let t=new Map;for(let r of e){let e=u(new Date(r.e.start));t.has(e)||t.set(e,[]),t.get(e).push(r)}for(let e of t.keys())t.get(e).sort((e,t)=>new Date(e.e.start)-new Date(t.e.start));return t},[]);(0,n.useMemo)(()=>({state:{calendars:r,selectedCalendarUrls:i,currentDate:C},toInputDate:u,toInputDateTimeLocal:c,endOfDay:d,isSameDate:p,formatWeekdayShort:m,formatTimeLabel:x,formatMonthLabel:f,formatDayMonth:v,formatLongDate:S,startOfWeek:g,minutesFromStartOfDay:b,getHourHeightPx:j,layoutOverlappingEvents:w,getEventsForVisibleCalendars:H,groupEventsByDateKey:Y,createEventChip:V,createDayHeader:K,showEditor:e=>z(e),escapeHtml:h,formatDateTime:D}),[r,i,C,H,Y]);let J=(0,n.useCallback)(async()=>{let{start:t,end:r}=E(),a=[...i],n=await Promise.all(a.map(async a=>{let n="demo"===e.serverUrl?{demo:!0,calendarUrl:a,timeMin:t.toISOString(),timeMax:r.toISOString()}:{serverUrl:e.serverUrl,username:e.username,password:e.password,calendarUrl:a,timeMin:t.toISOString(),timeMax:r.toISOString()},{events:l}=await _("/api/list-events",n);return{url:a,events:l||[]}})),l=new Map;for(let{url:e,events:t}of n)l.set(e,t);N(l)},[i,e,E,_]);function I(e){let t=new Date(C);"month"===k?t.setMonth(t.getMonth()+e):"week"===k?t.setDate(t.getDate()+7*e):t.setDate(t.getDate()+e),P(t)}function z(e){T(e||null),A(!0)}function R(){A(!1),T(null)}async function G(t){let r="demo"===e.serverUrl?{demo:!0}:{serverUrl:e.serverUrl,username:e.username,password:e.password};try{t.href?await _("/api/update-event",{...r,calendarObjectUrl:t.href,etag:t.etag,event:t.event}):await _("/api/create-event",{...r,calendarUrl:t.calendarUrl,event:t.event}),await J(),R()}catch(e){alert(e.message||"Fehler beim Speichern")}}return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("section",{className:"card",children:[a.jsx("h2",{children:"Kalender"}),a.jsx("div",{className:"calendar-list",children:r.map(e=>(0,a.jsxs)("div",{className:"calendar-item",children:[a.jsx("input",{type:"checkbox",checked:i.has(e.url),onChange:t=>(function(e,t){let r=new Set(i);t?r.add(e):r.delete(e),y(r)})(e.url,t.target.checked)}),a.jsx("span",{children:e.displayName}),a.jsx("span",{className:"pill",style:{borderColor:e.color||"var(--border)",color:e.color||"var(--muted)"},children:e.color||"#"}),a.jsx("button",{onClick:()=>z({calendarUrl:e.url}),children:"Neu"})]},e.url))})]}),(0,a.jsxs)("section",{className:"card",children:[(0,a.jsxs)("div",{className:"calendar-toolbar","aria-label":"Kalender Navigation",children:[(0,a.jsxs)("div",{className:"left",children:[(0,a.jsxs)("div",{className:"nav",children:[a.jsx("button",{onClick:()=>I(-1),title:"Zur\xfcck",children:"◀"}),a.jsx("button",{onClick:()=>I(1),title:"Weiter",children:"▶"}),a.jsx("button",{onClick:()=>P(new Date),title:"Heute",children:"Heute"})]}),a.jsx("div",{className:"current-range",children:q})]}),a.jsx("div",{className:"right",children:(0,a.jsxs)("div",{className:"view-switch",role:"tablist","aria-label":"Ansicht wechseln",children:[a.jsx("button",{role:"tab","aria-selected":String("month"===k),onClick:()=>M("month"),children:"Monat"}),a.jsx("button",{role:"tab","aria-selected":String("week"===k),onClick:()=>M("week"),children:"Woche"}),a.jsx("button",{role:"tab","aria-selected":String("day"===k),onClick:()=>M("day"),children:"Tag"}),a.jsx("button",{role:"tab","aria-selected":String("agenda"===k),onClick:()=>M("agenda"),children:"Liste"})]})})]}),a.jsx("div",{className:"calendar-view",ref:U,"aria-live":"polite"})]}),F&&a.jsx(o,{onCancel:R,onSave:G,calendars:r,initial:O})]});function V(e,t){let r=document.createElement("button");r.className="evt-chip",r.style.borderLeftColor=e.color||"var(--accent)",r.title=`${t.summary||""}`;let a=t.allDay?"Ganzt\xe4gig":x(new Date(t.start));return r.innerHTML=`<span class="dot" style="background:${e.color||"var(--accent)"}"></span><span class="txt">${h(a)} ${h(t.summary||"")}</span>`,r.addEventListener("click",r=>{r.stopPropagation(),z({href:t.href,etag:t.etag,calendarUrl:e.url,summary:t.summary,description:t.description,location:t.location,start:t.start,end:t.end,allDay:t.allDay})}),r}function K(e){let t=document.createElement("div");t.className="day-head";let r=p(e,new Date);return t.innerHTML=`<span class="dow">${m(e)}</span><span class="dom ${r?"today":""}">${e.getDate()}</span>`,t}}function i(){return a.jsx(n.Suspense,{fallback:null,children:a.jsx(s,{})})}function o({onCancel:e,onSave:t,calendars:r,initial:l}){let[s,i]=(0,n.useState)(l?.href||""),[o,u]=(0,n.useState)(l?.etag||""),[d,h]=(0,n.useState)(l?.calendarUrl||r[0]?.url||""),[g,p]=(0,n.useState)(l?.summary||""),[m,x]=(0,n.useState)(l?.description||""),[f,v]=(0,n.useState)(l?.location||""),[S,b]=(0,n.useState)(!!l?.allDay),j=l?.start?new Date(l.start):new Date,w=new Date(l?.end?l.end:j.getTime()+36e5),[D,y]=(0,n.useState)(c(j)),[k,M]=(0,n.useState)(c(w));return(0,a.jsxs)("section",{className:"card",id:"editSection",children:[a.jsx("h2",{id:"editTitle",children:s?"Termin bearbeiten":"Neuer Termin"}),(0,a.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),!D||!k)return alert("Bitte Start/Ende angeben");let r=new Date(D),a=new Date(k);if(a<=r)return alert("Ende muss nach Start liegen");t({calendarUrl:d,href:s||void 0,etag:o||void 0,event:{summary:g.trim(),description:m.trim(),location:f.trim(),start:r.toISOString(),end:a.toISOString(),allDay:S}})},children:[a.jsx("input",{type:"hidden",value:s,onChange:e=>i(e.target.value)}),a.jsx("input",{type:"hidden",value:o,onChange:e=>u(e.target.value)}),(0,a.jsxs)("label",{children:["Kalender",a.jsx("select",{required:!0,value:d,onChange:e=>h(e.target.value),children:r.map(e=>a.jsx("option",{value:e.url,children:e.displayName},e.url))})]}),(0,a.jsxs)("label",{children:["Betreff",a.jsx("input",{type:"text",required:!0,value:g,onChange:e=>p(e.target.value)})]}),(0,a.jsxs)("label",{children:["Beschreibung",a.jsx("textarea",{rows:3,value:m,onChange:e=>x(e.target.value)})]}),(0,a.jsxs)("label",{children:["Ort",a.jsx("input",{type:"text",value:f,onChange:e=>v(e.target.value)})]}),(0,a.jsxs)("div",{className:"row",children:[(0,a.jsxs)("label",{children:["Start",a.jsx("input",{type:"datetime-local",required:!0,value:D,onChange:e=>y(e.target.value)})]}),(0,a.jsxs)("label",{children:["Ende",a.jsx("input",{type:"datetime-local",required:!0,value:k,onChange:e=>M(e.target.value)})]})]}),(0,a.jsxs)("label",{className:"checkbox",children:[a.jsx("input",{type:"checkbox",checked:S,onChange:e=>b(e.target.checked)})," Ganzt\xe4gig"]}),(0,a.jsxs)("div",{className:"row right",children:[a.jsx("button",{type:"button",onClick:e,children:"Abbrechen"}),a.jsx("button",{type:"submit",children:"Speichern"})]})]})]})}function u(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${a}`}function c(e){let t=u(e),r=String(e.getHours()).padStart(2,"0"),a=String(e.getMinutes()).padStart(2,"0");return`${t}T${r}:${a}`}function d(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59,999)}function h(e){return String(e).replace(/[&<>"]/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"})[e])}function g(e){let t=(e.getDay()+6)%7,r=new Date(e.getFullYear(),e.getMonth(),e.getDate());return r.setDate(r.getDate()-t),r}function p(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function m(e){return["Mo","Di","Mi","Do","Fr","Sa","So"][(e.getDay()+6)%7]}function x(e){let t=String(e.getHours()).padStart(2,"0"),r=String(e.getMinutes()).padStart(2,"0");return`${t}:${r}`}function f(e){return`${["Jan","Feb","M\xe4r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"][e.getMonth()]} ${e.getFullYear()}`}function v(e){return`${e.getDate()}. ${["Jan","Feb","M\xe4r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"][e.getMonth()]}`}function S(e){return`${["So","Mo","Di","Mi","Do","Fr","Sa"][e.getDay()]}, ${e.getDate()}. ${["Jan","Feb","M\xe4r","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"][e.getMonth()]} ${e.getFullYear()}`}function b(e){return 60*e.getHours()+e.getMinutes()}function j(){return 48}function w(e){let t=[...e].sort((e,t)=>e.start-t.start||e.end-t.end),r=[],a=[];for(let e of t){let t=-1;for(let a=0;a<r.length;a++)if(r[a][r[a].length-1].end<=e.start){r[a].push(e),t=a;break}-1===t&&(r.push([e]),t=r.length-1),a.push({...e,trackIndex:t,trackCount:0})}let n=r.length||1;for(let e of a)e.trackCount=n;return a}function D(e,t){if(!e)return"";let r=new Date(e);return t?u(r):`${u(r)} ${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}`}},5047:(e,t,r)=>{"use strict";var a=r(7389);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},5671:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(8570).createProxy)(String.raw`/workspace/app/calendar/page.js#default`)},7764:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s,metadata:()=>l});var a=r(9510),n=r(7371);r(7272);let l={title:"CalDAV Webapp",description:"Webanwendung zum Anzeigen und Editieren von CalDAV-Kalendern"};function s({children:e}){return a.jsx("html",{lang:"de",children:(0,a.jsxs)("body",{children:[(0,a.jsxs)("header",{children:[a.jsx("h1",{children:"CalDAV Webapp"}),(0,a.jsxs)("nav",{className:"topnav",children:[a.jsx(n.default,{href:"/",children:"Verbindung"}),a.jsx(n.default,{href:"/calendar",children:"Kalender"}),a.jsx(n.default,{href:"/events",children:"Termine"})]})]}),a.jsx("main",{children:e}),a.jsx("footer",{children:a.jsx("small",{children:"Hinweis: Viele CalDAV-Server erfordern vertrauensw\xfcrdige Zertifikate. CORS wird \xfcber den API-Server gel\xf6st."})})]})})}},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,707],()=>r(394));module.exports=a})();