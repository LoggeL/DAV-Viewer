(()=>{var e={};e.id=38,e.ids=[38],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2304:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>l.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>o}),r(2045),r(7764),r(5866);var n=r(3191),a=r(8716),s=r(7922),l=r.n(s),i=r(5231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);r.d(t,d);let o=["",{children:["events",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,2045)),"/workspace/app/events/page.js"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,7764)),"/workspace/app/layout.js"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,5866,23)),"next/dist/client/components/not-found-error"]}],c=["/workspace/app/events/page.js"],u="/events/page",h={require:r,loadChunk:()=>Promise.resolve()},p=new n.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/events/page",pathname:"/events",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},8437:(e,t,r)=>{Promise.resolve().then(r.bind(r,7320))},9447:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,9404,23))},1251:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,2994,23)),Promise.resolve().then(r.t.bind(r,6114,23)),Promise.resolve().then(r.t.bind(r,9727,23)),Promise.resolve().then(r.t.bind(r,9671,23)),Promise.resolve().then(r.t.bind(r,1868,23)),Promise.resolve().then(r.t.bind(r,4759,23))},7320:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});var n=r(326),a=r(7577);function s(){let[e,t]=(0,a.useState)({serverUrl:"",username:"",password:""}),[r,s]=(0,a.useState)([]),[d,c]=(0,a.useState)(new Set),[u,h]=(0,a.useState)(()=>i(new Date(new Date().getFullYear(),new Date().getMonth(),1))),[p,m]=(0,a.useState)(()=>i(new Date(new Date().getFullYear(),new Date().getMonth()+1,0))),[x,g]=(0,a.useState)([]),[v,j]=(0,a.useState)(!1),[f,b]=(0,a.useState)(null);async function S(e,t){let r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await r.json();if(!r.ok)throw Error(n?.error||"Fehler");return n}async function w(){let t=u?new Date(u):null,n=p?new Date(p):null,a=[...d],s="demo"===e.serverUrl?{demo:!0}:{serverUrl:e.serverUrl,username:e.username,password:e.password},l=await Promise.all(a.map(async e=>{let{events:r}=await S("/api/list-events",{...s,calendarUrl:e,timeMin:t?t.toISOString():void 0,timeMax:n?new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999).toISOString():void 0});return{url:e,events:r||[]}})),i=[];for(let e of r)for(let t of l.find(t=>t.url===e.url)?.events||[])i.push({cal:e,e:t});i.sort((e,t)=>new Date(e.e.start)-new Date(t.e.start)),g(i)}function y(e){b(e||null),j(!0)}async function D(t){let r="demo"===e.serverUrl?{demo:!0}:{serverUrl:e.serverUrl,username:e.username,password:e.password};try{t.href?await S("/api/update-event",{...r,calendarObjectUrl:t.href,etag:t.etag,event:t.event}):await S("/api/create-event",{...r,calendarUrl:t.calendarUrl,event:t.event}),await w(),j(!1),b(null)}catch(e){alert(e.message||"Fehler beim Speichern")}}async function C(t){if(!confirm("Termin wirklich l\xf6schen?"))return;let r="demo"===e.serverUrl?{demo:!0}:{serverUrl:e.serverUrl,username:e.username,password:e.password};try{await S("/api/delete-event",{...r,calendarObjectUrl:t.href,etag:t.etag}),await w()}catch(e){alert(e.message||"Fehler beim L\xf6schen")}}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("section",{className:"card",children:[n.jsx("h2",{children:"Kalender"}),n.jsx("div",{className:"calendar-list",children:r.map(e=>(0,n.jsxs)("div",{className:"calendar-item",children:[n.jsx("input",{type:"checkbox",checked:d.has(e.url),onChange:t=>(function(e,t){let r=new Set(d);t?r.add(e):r.delete(e),c(r)})(e.url,t.target.checked)}),n.jsx("span",{children:e.displayName}),n.jsx("span",{className:"pill",style:{borderColor:e.color||"var(--border)",color:e.color||"var(--muted)"},children:e.color||"#"}),n.jsx("button",{onClick:()=>y({calendarUrl:e.url}),children:"Neu"})]},e.url))}),(0,n.jsxs)("div",{className:"row",children:[(0,n.jsxs)("label",{children:["Von",n.jsx("input",{type:"date",value:u,onChange:e=>h(e.target.value)})]}),(0,n.jsxs)("label",{children:["Bis",n.jsx("input",{type:"date",value:p,onChange:e=>m(e.target.value)})]}),n.jsx("button",{onClick:w,children:"Termine laden"})]})]}),(0,n.jsxs)("section",{className:"card",children:[n.jsx("h2",{children:"Termine"}),(0,n.jsxs)("table",{children:[n.jsx("thead",{children:(0,n.jsxs)("tr",{children:[n.jsx("th",{children:"Kalender"}),n.jsx("th",{children:"Betreff"}),n.jsx("th",{children:"Start"}),n.jsx("th",{children:"Ende"}),n.jsx("th",{})]})}),n.jsx("tbody",{children:x.map(({cal:e,e:t})=>(0,n.jsxs)("tr",{children:[n.jsx("td",{children:e.displayName}),n.jsx("td",{children:t.summary||""}),n.jsx("td",{children:o(t.start,t.allDay)}),n.jsx("td",{children:o(t.end,t.allDay)}),(0,n.jsxs)("td",{children:[n.jsx("button",{onClick:()=>y({href:t.href,etag:t.etag,calendarUrl:e.url,summary:t.summary,description:t.description,location:t.location,start:t.start,end:t.end,allDay:t.allDay}),children:"Bearbeiten"}),n.jsx("button",{className:"danger",onClick:()=>C(t),children:"L\xf6schen"})]})]},t.href))})]})]}),v&&n.jsx(l,{onCancel:()=>j(!1),onSave:D,calendars:r,initial:f})]})}function l({onCancel:e,onSave:t,calendars:r,initial:s}){let[l,i]=(0,a.useState)(s?.href||""),[o,c]=(0,a.useState)(s?.etag||""),[u,h]=(0,a.useState)(s?.calendarUrl||r[0]?.url||""),[p,m]=(0,a.useState)(s?.summary||""),[x,g]=(0,a.useState)(s?.description||""),[v,j]=(0,a.useState)(s?.location||""),[f,b]=(0,a.useState)(!!s?.allDay),S=s?.start?new Date(s.start):new Date,w=new Date(s?.end?s.end:S.getTime()+36e5),[y,D]=(0,a.useState)(d(S)),[C,P]=(0,a.useState)(d(w));return(0,n.jsxs)("section",{className:"card",id:"editSection",children:[n.jsx("h2",{id:"editTitle",children:l?"Termin bearbeiten":"Neuer Termin"}),(0,n.jsxs)("form",{onSubmit:function(e){if(e.preventDefault(),!y||!C)return alert("Bitte Start/Ende angeben");let r=new Date(y),n=new Date(C);if(n<=r)return alert("Ende muss nach Start liegen");t({calendarUrl:u,href:l||void 0,etag:o||void 0,event:{summary:p.trim(),description:x.trim(),location:v.trim(),start:r.toISOString(),end:n.toISOString(),allDay:f}})},children:[n.jsx("input",{type:"hidden",value:l,onChange:e=>i(e.target.value)}),n.jsx("input",{type:"hidden",value:o,onChange:e=>c(e.target.value)}),(0,n.jsxs)("label",{children:["Kalender",n.jsx("select",{required:!0,value:u,onChange:e=>h(e.target.value),children:r.map(e=>n.jsx("option",{value:e.url,children:e.displayName},e.url))})]}),(0,n.jsxs)("label",{children:["Betreff",n.jsx("input",{type:"text",required:!0,value:p,onChange:e=>m(e.target.value)})]}),(0,n.jsxs)("label",{children:["Beschreibung",n.jsx("textarea",{rows:3,value:x,onChange:e=>g(e.target.value)})]}),(0,n.jsxs)("label",{children:["Ort",n.jsx("input",{type:"text",value:v,onChange:e=>j(e.target.value)})]}),(0,n.jsxs)("div",{className:"row",children:[(0,n.jsxs)("label",{children:["Start",n.jsx("input",{type:"datetime-local",required:!0,value:y,onChange:e=>D(e.target.value)})]}),(0,n.jsxs)("label",{children:["Ende",n.jsx("input",{type:"datetime-local",required:!0,value:C,onChange:e=>P(e.target.value)})]})]}),(0,n.jsxs)("label",{className:"checkbox",children:[n.jsx("input",{type:"checkbox",checked:f,onChange:e=>b(e.target.checked)})," Ganzt\xe4gig"]}),(0,n.jsxs)("div",{className:"row right",children:[n.jsx("button",{type:"button",onClick:e,children:"Abbrechen"}),n.jsx("button",{type:"submit",children:"Speichern"})]})]})]})}function i(e){let t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${n}`}function d(e){let t=i(e),r=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0");return`${t}T${r}:${n}`}function o(e,t){if(!e)return"";let r=new Date(e);return t?i(r):`${i(r)} ${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}`}},2045:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});let n=(0,r(8570).createProxy)(String.raw`/workspace/app/events/page.js#default`)},7764:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l,metadata:()=>s});var n=r(9510),a=r(7371);r(7272);let s={title:"CalDAV Webapp",description:"Webanwendung zum Anzeigen und Editieren von CalDAV-Kalendern"};function l({children:e}){return n.jsx("html",{lang:"de",children:(0,n.jsxs)("body",{children:[(0,n.jsxs)("header",{children:[n.jsx("h1",{children:"CalDAV Webapp"}),(0,n.jsxs)("nav",{className:"topnav",children:[n.jsx(a.default,{href:"/",children:"Verbindung"}),n.jsx(a.default,{href:"/calendar",children:"Kalender"}),n.jsx(a.default,{href:"/events",children:"Termine"})]})]}),n.jsx("main",{children:e}),n.jsx("footer",{children:n.jsx("small",{children:"Hinweis: Viele CalDAV-Server erfordern vertrauensw\xfcrdige Zertifikate. CORS wird \xfcber den API-Server gel\xf6st."})})]})})}},7272:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[276,707],()=>r(2304));module.exports=n})();